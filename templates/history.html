{% extends "layout.html" %}

{% block content %}
<div class="animate-fade-in"
    style="margin-bottom: 3rem; display: flex; justify-content: space-between; align-items: flex-end;">
    <div>
        <h1 style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem; letter-spacing: -1px;">
            System <span class="text-gradient">History</span>
        </h1>
        <p style="color: var(--text-dim); font-size: 1.1rem;">Full list of student submissions and registered members.
        </p>
    </div>
    <a href="{{ url_for('admin_dashboard') }}" class="btn"
        style="padding: 0.75rem 1.5rem; background: rgba(255,255,255,0.05); color: var(--text-main);">
        <svg style="width:20px; height:20px" viewBox="0 0 24 24">
            <path fill="currentColor" d="M21,11H6.83L10.41,7.41L9,6L3,12L9,18L10.41,16.58L6.83,13H21V11Z" />
        </svg>
        Back to Dashboard
    </a>
</div>

<div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 2.5rem; align-items: start;">
    <!-- Left Column: All Submissions Section -->
    <div class="card" style="border-top: 5px solid var(--accent);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <div
                    style="width: 40px; height: 40px; background: rgba(16, 185, 129, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--accent);">
                    <svg style="width:24px; height:24px" viewBox="0 0 24 24">
                        <path fill="currentColor"
                            d="M14,10H19.5L14,4.5V10M5,3H15L21,9V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5C3,3.89 3.89,3 5,3M5,5V19H19V12H12V5H5Z" />
                    </svg>
                </div>
                <h2 style="font-size: 1.5rem; font-weight: 700;">Complete History</h2>
            </div>
            <span
                style="background: rgba(16, 185, 129, 0.1); color: var(--accent); padding: 0.4rem 1rem; border-radius: 2rem; font-size: 0.85rem; font-weight: 700;">{{
                results|length }} Total</span>
        </div>

        <div style="display: grid; gap: 1.5rem;">
            {% if results %}
            {% for res in results %}
            <div class="submission-item {{ 'correct' if res.is_correct else 'incorrect' }}"
                style="background: rgba(255,255,255,0.02); padding: 1.5rem; border-radius: 1rem; border: 1px solid var(--glass-border);">
                <div
                    style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                    <div>
                        <div style="font-weight: 800; font-size: 1.1rem; color: var(--text-main);">{{
                            res.student.full_name or res.student.username }}</div>
                        <div style="font-size: 0.8rem; color: var(--text-dim);">@{{ res.student.username }}</div>
                    </div>
                    <span
                        style="font-size: 0.75rem; color: var(--text-dim); background: rgba(255,255,255,0.05); padding: 2px 8px; border-radius: 4px;">
                        {{ res.submitted_at.strftime('%H:%M %b %d') }}
                    </span>
                </div>

                <div
                    style="margin-bottom: 1.5rem; padding: 0.75rem; background: rgba(255,255,255,0.02); border-radius: 0.5rem; border-left: 3px solid var(--primary);">
                    <p style="color: var(--text-main); font-size: 0.9rem; line-height: 1.4; margin: 0;">
                        {{ res.question.text[:100] }}{{ '...' if res.question.text|length > 100 }}
                    </p>
                </div>

                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 2rem;">
                        <div style="flex: 1; display: flex; flex-direction: column; gap: 6px;">
                            <span
                                style="font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; font-weight: 700;">Student's
                                Choice</span>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <div class="option-indicator {{ 'correct' if res.is_correct else 'incorrect' }}">
                                    {{ res.selected_option }}
                                </div>
                                <span style="font-size: 0.95rem; color: var(--text-main); font-weight: 500;">
                                    {% if res.selected_option == 'A' %}{{ res.question.option_a }}
                                    {% elif res.selected_option == 'B' %}{{ res.question.option_b }}
                                    {% elif res.selected_option == 'C' %}{{ res.question.option_c }}
                                    {% elif res.selected_option == 'D' %}{{ res.question.option_d }}
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        <div
                            style="flex: 1; display: flex; flex-direction: column; gap: 6px; align-items: flex-end; text-align: right;">
                            <span
                                style="font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; font-weight: 700;">Correct
                                Answer</span>
                            <div style="display: flex; gap: 12px; align-items: center; justify-content: flex-end;">
                                <span style="font-size: 0.95rem; color: var(--accent); font-weight: 500;">
                                    {% if res.question.correct_answer == 'A' %}{{ res.question.option_a }}
                                    {% elif res.question.correct_answer == 'B' %}{{ res.question.option_b }}
                                    {% elif res.question.correct_answer == 'C' %}{{ res.question.option_c }}
                                    {% elif res.question.correct_answer == 'D' %}{{ res.question.option_d }}
                                    {% endif %}
                                </span>
                                <div class="option-indicator correct">
                                    {{ res.question.correct_answer }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.05);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div
                                style="width: 8px; height: 8px; border-radius: 50%; background: {{ 'var(--accent)' if res.is_correct else 'var(--danger)' }};">
                            </div>
                            <span class="status-text {{ 'correct' if res.is_correct else 'incorrect' }}"
                                style="font-size: 0.85rem; font-weight: 800; letter-spacing: 0.5px;">
                                {{ 'SUBMISSION CORRECT' if res.is_correct else 'SUBMISSION INCORRECT' }}
                            </span>
                        </div>

                        {% if res.file_path %}
                        <a href="{{ url_for('download_file', filename=res.file_path) }}" class="btn"
                            style="padding: 0.5rem 1rem; background: rgba(99, 102, 241, 0.1); color: var(--primary); font-size: 0.75rem; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                            <svg style="width:16px; height:16px" viewBox="0 0 24 24">
                                <path fill="currentColor"
                                    d="M14,2L20,8V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2H14M13,3.5V9H18.5L13,3.5M7,11V13H17V11H7M7,15V17H14V15H7Z" />
                            </svg>
                            Download Solution
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div
                style="text-align: center; padding: 4rem 0; background: rgba(255,255,255,0.02); border-radius: 1rem; border: 2px dashed var(--glass-border);">
                <p style="color: var(--text-dim);">No submissions yet.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Right Column: College Members Section -->
    <div class="card" style="border-top: 5px solid var(--secondary);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <div
                    style="width: 40px; height: 40px; background: rgba(139, 92, 246, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: var(--secondary);">
                    <svg style="width:24px; height:24px" viewBox="0 0 24 24">
                        <path fill="currentColor"
                            d="M16,13C15.71,13 15.38,13 15.03,13.05C16.19,13.89 17,15 17,16.5V19H23V16.5C23,14.17 18.33,13 16,13M8,13C5.67,13 1,14.17 1,16.5V19H15V16.5C15,14.17 10.33,13 8,13M8,11A3,3 0 0,0 11,8A3,3 0 0,0 8,5A3,3 0 0,0 5,8A3,3 0 0,0 8,11M16,11A3,3 0 0,0 19,8A3,3 0 0,0 16,5A3,3 0 0,0 13,8A3,3 0 0,0 16,11Z" />
                    </svg>
                </div>
                <h2 style="font-size: 1.5rem; font-weight: 700;">Members</h2>
            </div>
            <span
                style="background: rgba(139, 92, 246, 0.1); color: var(--secondary); padding: 0.4rem 1rem; border-radius: 2rem; font-size: 0.85rem; font-weight: 700;">{{
                all_users|length }}</span>
        </div>

        <div style="display: grid; gap: 1rem;">
            {% for user in all_users %}
            <div class="glass-panel"
                style="padding: 1.25rem; display: flex; align-items: center; gap: 1rem; border: 1px solid var(--glass-border);">
                <div
                    style="width: 45px; height: 45px; background: rgba(139, 92, 246, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--secondary); flex-shrink: 0;">
                    <svg style="width:24px; height:24px" viewBox="0 0 24 24">
                        <path fill="currentColor"
                            d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" />
                    </svg>
                </div>
                <div style="min-width: 0;">
                    <div
                        style="font-weight: 700; color: var(--text-main); font-size: 1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        {{ user.full_name or user.username }}
                    </div>
                    <div style="font-size: 0.8rem; color: var(--primary);">@{{ user.username }}</div>
                </div>
                <div
                    style="margin-left: auto; font-size: 0.65rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; padding: 0.2rem 0.6rem; background: rgba(255,255,255,0.05); border-radius: 1rem; font-weight: 700;">
                    {{ user.role }}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .submission-item {
        border-left: 4px solid transparent;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .submission-item:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.04) !important;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .submission-item.correct {
        border-left-color: var(--accent);
    }

    .submission-item.incorrect {
        border-left-color: var(--danger);
    }

    .option-indicator {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 1rem;
        color: white;
    }

    .option-indicator.correct {
        background: var(--accent);
        box-shadow: 0 0 15px var(--accent);
    }

    .option-indicator.incorrect {
        background: var(--danger);
        box-shadow: 0 0 15px var(--danger);
    }

    .status-text.correct {
        color: var(--accent);
    }

    .status-text.incorrect {
        color: var(--danger);
    }
</style>
{% endblock %}